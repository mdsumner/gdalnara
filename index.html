<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read Imagery Data Directly to nativeRaster With GDAL • gdalnara</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Read Imagery Data Directly to nativeRaster With GDAL">
<meta property="og:description" content="Read imagery data from any GDAL source to Rs nativeRaster matrix. The 
 nativeRaster is largely undocumented, an integer-encoded RGB/A matrix in raster-orientation, 
 used by rasterImage()' and the png package. Doing the conversion from raw bytes in GDAL saves a significant
 amount of time and memory to get a picture from a raster source (file or URL or other GDAL supported raster). ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">gdalnara</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mdsumner/gdalnara/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="gdalnara">gdalnara<a class="anchor" aria-label="anchor" href="#gdalnara"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of gdalnara is to bridge the GDAL raster read to the nativeRaster of R.</p>
<p>Please consider this a temporary experiment, probably to be folded into vapour or another GDAL package.</p>
<div class="section level2">
<h2 id="what-the-heck-is-nativeraster-of-r">What the heck is nativeRaster of R?<a class="anchor" aria-label="anchor" href="#what-the-heck-is-nativeraster-of-r"></a>
</h2>
<p>Well exactly, it’s an integer-encoded value of RGB(A) in a matrix with an odd ordering convention. This is different to</p>
<ul>
<li>the xyz list of (usually degenerate) rectilinear x,y vectors and a z matrix in <code><a href="https://rdrr.io/r/graphics/image.html" class="external-link">graphics::image()</a></code>
</li>
<li>the raster-ordered array of RGB(A) used by <code><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">graphics::rasterImage()</a></code>, either values in 0,255 or character hex values in a matrix</li>
</ul>
<p>It’s not exposed at all in R documentation, but is used internally in R, and externally by the png package, and a little bit by farver and nara (more below).</p>
<p>First let’s look at <code><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage()</a></code>.</p>
<p>If we take a matrix of 12 numbers, and make an image using the standard spatial topleft -&gt; topright then then row-based ordering:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3L</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="cn">NA</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>; <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">xl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">xl</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="fu">scl</span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">4</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-matrix-1.png" width="100%"></p>
<p>with numbers in the range 0,1 we automatically get a greyscale image, but we can do that explicitly too:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mh</span> <span class="op">&lt;-</span> <span class="va">m</span></span>
<span><span class="va">mh</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">12</span>, start <span class="op">=</span> <span class="fl">0</span>, end <span class="op">=</span> <span class="fl">1</span>, gamma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="va">m</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="cn">NA</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="va">mh</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">4</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-hex-1.png" width="100%"></p>
<p>But, the size of the data has been multiplied nearly 10x and especially the size of the character matrix is quite large (let’s ignore the fact that we are using full RGB for greyscale, and that we might use 3 sets of raw rather than actual character strings, or the 3 sets of integer from col2rgb …).</p>
<p>Note that we are using <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> to strip attributes, because the small attributes are an significant size here compared to the data and using <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> is forbidden by R gods so we like doing it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 96 B</span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m</span> <span class="op">*</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>   <span class="co">## when we have to rescale to 0,1 we are double</span></span>
<span><span class="co">#&gt; 176 B</span></span>
<span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mh</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 848 B</span></span>
<span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="va">mh</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 192 B</span></span></code></pre></div>
<p>So what’s a nativeRaster?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mh</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#mi &lt;- m  ## we making sure we are integer type, whereas m could have been double or integer</span></span>
<span></span>
<span><span class="va">mn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">rgbvals</span><span class="op">[</span><span class="fl">1L</span>, <span class="op">]</span> <span class="op">*</span> <span class="fl">256</span> <span class="op">*</span> <span class="fl">256</span> <span class="op">+</span> </span>
<span> <span class="va">rgbvals</span><span class="op">[</span><span class="fl">2L</span>, <span class="op">]</span> <span class="op">*</span> <span class="fl">256</span>  <span class="op">+</span></span>
<span>  <span class="va">rgbvals</span><span class="op">[</span><span class="fl">3L</span>, <span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="fl">256</span> <span class="op">*</span> <span class="fl">256</span> <span class="op">*</span> <span class="fl">256</span><span class="op">)</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">3L</span><span class="op">)</span>, </span>
<span> class <span class="op">=</span> <span class="st">"nativeRaster"</span>, channels <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="cn">NA</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="va">mn</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">4</span>, interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-nativeRaster-1.png" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   </span>
<span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mn</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; 96 B</span></span></code></pre></div>
<p>So we’re done! No. All of that above is quite expensive because values get converted to numeric and integer and it’s potentially a lot of data getting thrown around when it was originally very compact in some cunning image format.</p>
</div>
<div class="section level2">
<h2 id="gdalnara-1">gdalnara<a class="anchor" aria-label="anchor" href="#gdalnara-1"></a>
</h2>
<p>The gdalnara package exists to bridge the three functions in the GDAL package vapour that can read natively or to any output grid extent, resolution, crs - but to do as much as possible in C++. These are</p>
<ul>
<li>gdal_raster_data (read numeric or Byte or Integer data as natively as possible in R - raw, integer, double)</li>
<li>gdal_raster_dsn (read a raster source and write it out to file)</li>
<li>gdal_raster_image (read a image data to a character string of colours in R, from 1, 3, or 4 bands)</li>
</ul>
<p>The last image function is quite nice because 3 Byte bands are coalesced into a single character string, but as shown above that can be quite large.</p>
<p>Doing things in C++ next to where we access the raster data with GDAL is neat, because a usual image scenario is Byte values, we can use bit shift in C++ which is very fast. In fact we copied the code from R itself because it’s very simple.</p>
<p>This code is also used in the png package by Simon Urbanek, with the function <code>readPNG()</code> and its <code>native</code> arg, in the farver package by Thomas Pederson, and in the nara package by Mike FC (which inspired this name and the effort to figure this out).</p>
<p>There’s a few packages on CRAN that know about nativeRaster: <a href="https://github.com/search?q=org%3Acran%20nativeRaster&amp;type=code" class="external-link uri">https://github.com/search?q=org%3Acran%20nativeRaster&amp;type=code</a></p>
</div>
<div class="section level2">
<h2 id="a-real-world-example">A real world example<a class="anchor" aria-label="anchor" href="#a-real-world-example"></a>
</h2>
<p>GDAL can read imagery to any extent and projection.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span>  <span class="st">"&lt;GDAL_WMS&gt;&lt;Service name=\"VirtualEarth\"&gt;&lt;ServerUrl&gt;http://a${server_num}.ortho.tiles.virtualearth.net/tiles/a${quadkey}.jpeg?g=90&lt;/ServerUrl&gt;&lt;/Service&gt;&lt;MaxConnections&gt;4&lt;/MaxConnections&gt;&lt;Cache/&gt;&lt;/GDAL_WMS&gt;"</span></span>
<span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2e5</span></span>
<span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="st">"+proj=laea +lon_0=147 +lat_0=-42"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ximage</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mdsumner/gdalnara" class="external-link">gdalnara</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/vapour" class="external-link">vapour</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">nara</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdal_raster_nara.html">gdal_raster_nara</a></span><span class="op">(</span><span class="va">dsn</span>, target_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1024</span>, <span class="fl">0</span><span class="op">)</span>, target_ext <span class="op">=</span> <span class="va">ex</span>, target_crs <span class="op">=</span> <span class="va">crs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.352   0.024   0.376</span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="va">nara</span><span class="op">)</span></span>
<span><span class="co">#&gt; 4.20 MB</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">chra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vapour/man/gdal_raster_data.html" class="external-link">gdal_raster_image</a></span><span class="op">(</span><span class="va">dsn</span>, target_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1024</span>, <span class="fl">0</span><span class="op">)</span>, target_ext <span class="op">=</span> <span class="va">ex</span>, target_crs <span class="op">=</span> <span class="va">crs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.547   0.064   0.611</span></span>
<span><span class="fu">pryr</span><span class="fu">::</span><span class="fu">object_size</span><span class="op">(</span><span class="va">chra</span><span class="op">)</span></span>
<span><span class="co">#&gt; 9.95 MB</span></span>
<span></span>
<span><span class="co">## it's very quick</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">ximage</span><span class="op">(</span><span class="va">nara</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-world-1.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user  system elapsed </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0.007   0.000   0.007</span></span></code></pre></div>
<p>It takes a lot of data to convert to RGB array and quite some time to plot.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span><span class="fu">nara</span><span class="fu">::</span><span class="fu">nr_to_array</span><span class="op">(</span><span class="va">nara</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,,<span class="op">-</span><span class="fl">4</span><span class="op">]</span>,   <span class="co">## drop alpha since we don't use it</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co">## and transpose so we can prove it's actually doing something</span></span>
<span></span>
<span><span class="fu">ximage</span><span class="op">(</span><span class="va">nara</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ex</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">ex</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">ex</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">ex</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-aperm-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user  system elapsed </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0.286   0.040   0.326</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">object_size</span>(x)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 25.17 MB</span></span></code></pre></div>
<p>We can even scale data to grey from numeric and read efficiently with gdalnara.</p>
<p>(note GDAL 3.7 required for this syntax, we might use VRT for other ways).</p>
<p>This is not that successful because we need to know the source range, quite complicated for subsets and reprojections etc. (but will fix later …).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="st">"vrt:///vsicurl/https://gebco2023.s3.valeria.science/gebco_2023_land_cog.tif?scale=-7676,5500,0,255&amp;ot=Float32"</span></span>
<span></span>
<span><span class="va">im</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdal_raster_nara.html">gdal_raster_nara</a></span><span class="op">(</span><span class="va">dsn</span>, target_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1024</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ximage</span><span class="op">(</span><span class="va">im</span><span class="op">)</span></span></code></pre></div>
<figure><img src="man/figures2/README-gdal-3.7-1.png" alt="world topography scaled to grey"><figcaption aria-hidden="true">
world topography scaled to grey
</figcaption></figure>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of gdalnara like so:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">install.package</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"mdsumner/gdalnara"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the gdalnara project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mdsumner/gdalnara/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mdsumner/gdalnara/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing gdalnara</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael Sumner <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
